<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulación de Partido - FutCode</title>
    <link rel="stylesheet" th:href="@{/css/partidoStyle.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
    .commentary-item.gol-favor {
        border-left: 6px solid #2ecc40;
        background: #193d1c;
        color: #2ecc40;
        font-weight: bold;
    }
    .commentary-item.gol-contra,
    .commentary-item.expulsion-propia {
        border-left: 6px solid #e74c3c;
        background: #3a1a1a;
        color: #e74c3c;
        font-weight: bold;
    }
    .commentary-item.expulsion-rival {
        border-left: 6px solid #2ecc40;
        background: #193d1c;
        color: #2ecc40;
        font-weight: bold;
    }
    .commentary-item.tarjeta-amarilla {
        border-left: 6px solid #ffe066;
        background: #3a381a;
        color: #ffe066;
        font-weight: bold;
    }
    .commentary-item.tarjeta-roja {
        border-left: 6px solid #e74c3c;
        background: #3a1a1a;
        color: #e74c3c;
        font-weight: bold;
    }
    .commentary-item.lesion {
        border-left: 6px solid #ff8800;
        background: #3a2a1a;
        color: #ff8800;
        font-weight: bold;
    }
    
    /* Animación de puntos suspensivos */
    .loading-dots {
        display: inline-block;
        color: #00ffc3;
        font-weight: bold;
    }
    
    .loading-dots::after {
        content: '';
        animation: dots 1.5s infinite;
    }
    
    @keyframes dots {
        0%, 20% { content: ''; }
        40% { content: '.'; }
        60% { content: '..'; }
        80%, 100% { content: '...'; }
    }
    
    /* Modal de victoria mejorado */
    .victory-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        animation: fadeIn 0.5s ease-in;
    }
    
    .victory-card {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        border: 2px solid #ffd700;
        border-radius: 20px;
        padding: 40px 60px;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        animation: slideIn 0.6s ease-out;
        max-width: 700px;
        width: 90%;
    }

    .victory-title {
        color: #ffd700;
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 15px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .victory-subtitle {
        color: #ffffff;
        font-size: 1.2rem;
        opacity: 0.9;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideIn {
        from { 
            transform: translateY(-50px);
            opacity: 0;
        }
        to { 
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
    }
    
    /* Estilos para escudos de equipos */
    .team-logo {
        width: 70px;
        height: 70px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
    }
    
    .team-escudo {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        padding: 5px;
    }
    
    .team-initials {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #00ffc3, #00d4a3);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0d1b2a;
        font-weight: bold;
        font-size: 1.2rem;
        text-transform: uppercase;
    }
    
    .team {
        display: flex;
        align-items: center;
        flex-direction: column;
        text-align: center;
    }
    
    .team-name {
        margin: 10px 0 5px 0;
        font-weight: bold;
        font-size: 1.1rem;
    }
    
    .team-score {
        font-size: 2rem;
        font-weight: bold;
        color: #00ffc3;
    }
    </style>
</head>
<body>
<div class="container">
    <!-- Botón de volver -->
    <div style="margin-bottom: 20px;">
        <a th:href="@{/home}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> VOLVER
        </a>
    </div>
    
    <div class="header">
        <h1> SIMULACIÓN DE PARTIDO</h1>
    </div>

    <div class="match-info">
        <div class="team">
            <div class="team-logo">
                <img th:if="${equipoLocal.imagen}" th:src="${equipoLocal.imagen}" alt="Escudo Local" class="team-escudo">
                <div th:unless="${equipoLocal.imagen}" class="team-initials" th:text="${#strings.substring(equipoLocal.nombre, 0, 2)}">RP</div>
            </div>
            <div class="team-name" id="team1Name" th:text="${equipoLocal.nombre}">River Plate</div>
            <div class="team-score" id="team1Score">0</div>
        </div>
        <div class="vs">VS</div>
        <div class="team">
            <div class="team-logo">
                <img th:if="${equipoVisitante.imagen}" th:src="${equipoVisitante.imagen}" alt="Escudo Visitante" class="team-escudo">
                <div th:unless="${equipoVisitante.imagen}" class="team-initials" th:text="${#strings.substring(equipoVisitante.nombre, 0, 2)}">BJ</div>
            </div>
            <div class="team-name" id="team2Name" th:text="${equipoVisitante.nombre}">Boca Juniors</div>
            <div class="team-score" id="team2Score">0</div>
        </div>
    </div>

    <div class="match-status">
        <div class="time-display" id="matchTime">0'</div>
        <div class="status-indicator playing" id="statusIndicator">EN JUEGO</div>
    </div>

    <div class="controls">
        <button class="btn btn-primary" id="startBtn">INICIAR PARTIDO</button>
        <!-- <button class="btn btn-secondary" id="pauseBtn">PAUSAR</button> -->
        <!-- <button class="btn btn-secondary" id="resetBtn">REINICIAR</button> -->
    </div>

    <div class="stats-section">
        <div class="stat-card">
            <div class="stat-title">Goles Total</div>
            <div class="stat-value" id="totalGoals">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Faltas</div>
            <div class="stat-value" id="totalFouls">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Tarjetas</div>
            <div class="stat-value" id="totalCards">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Lesionados</div>
            <div class="stat-value" id="totalInjuries">0</div>
        </div>
    </div>

    <div class="commentary-section scrollbar">
        <div class="commentary-title">
            NARRACIÓN EN VIVO <span id="loadingDots" class="loading-dots"></span>
        </div>
        <div id="commentaryList">
            <div th:each="narracion : ${narraciones}"  class="commentary-item"
                 th:attr="data-minuto=${narracion.minuto},data-tipo=${narracion.tipoEvento}">
                <span class="commentary-minute" th:text="${narracion.minuto} + '\''"></span>
                <span th:text="${narracion.texto}">Aquí va una frase...</span>
            </div>
        </div>
        <input type="hidden" id="equipoUsuario" th:value="${equipoUsuario}" />
        <input type="hidden" id="equipoLocal" th:value="${equipoLocal}" />
        <input type="hidden" id="equipoVisitante" th:value="${equipoVisitante}" />
        <input type="hidden" id="monedasGanadas" th:value="${monedasGanadas}" />
        <input type="hidden" id="golesLocalFinal" th:value="${golesLocal}" />
        <input type="hidden" id="golesVisitanteFinal" th:value="${golesVisitante}" />
        <input type="hidden" id="nombreLocalFinal" th:value="${equipoLocal.nombre}" />
        <input type="hidden" id="nombreVisitanteFinal" th:value="${equipoVisitante.nombre}" />
        <input type="hidden" id="equipoUsuarioFinal" th:value="${equipoUsuario}" />
    </div>
    <div id="boton-omitir">
        <button class="btn" id="omitebtn">OMITIR NARRACIÓN</button>
    </div>


</div>
<script>
// Elementos del DOM
const matchTime = document.getElementById("matchTime");
const statusIndicator = document.getElementById("statusIndicator");
const team1Score = document.getElementById("team1Score");
const team2Score = document.getElementById("team2Score");
const totalGoals = document.getElementById("totalGoals");
const totalFouls = document.getElementById("totalFouls");
const totalCards = document.getElementById("totalCards");
const totalInjuries = document.getElementById("totalInjuries");
const commentaryList = document.getElementById("commentaryList");
const startBtn = document.getElementById("startBtn");
const omiteBtn = document.getElementById("omitebtn");

// Obtener el equipo del usuario desde el backend
const equipoLocal = document.getElementById("equipoLocal").value.trim().toLowerCase();
const equipoVisitante = document.getElementById("equipoVisitante").value.trim().toLowerCase();

// Determinar cuál es realmente el equipo del usuario
// Necesitamos verificar si el usuario juega como local o visitante
const equipoUsuario = document.getElementById("equipoUsuario").value.trim().toLowerCase();

// Determinar cuál es el rival del usuario
let equipoRival;
if (equipoUsuario === equipoLocal) {
    equipoRival = equipoVisitante;
} else if (equipoUsuario === equipoVisitante) {
    equipoRival = equipoLocal;
} else {
    // Si no coincide con ninguno, asumir que es local
    equipoRival = equipoVisitante;
}

// Obtener todas las narraciones enriquecidas
const narraciones = Array.from(commentaryList.querySelectorAll(".commentary-item"))
    .map(item => ({
        minuto: parseInt(item.getAttribute("data-minuto")),
        tipo: item.getAttribute("data-tipo"),
        texto: item.querySelector("span:nth-child(2)").textContent,
        node: item
    }));

narraciones.sort((a, b) => a.minuto - b.minuto);

// Estado
let tiempo = 0;
let partidoEnCurso = false;
let partidoTerminado = false;
let intervalo = null;
let narracionIndex = 0;
let velocidadNarracion = 1000;
let omitirNarracion = false;
let bonusMonedas = 500;

let stats = {
    goles: 0,
    faltas: 0,
    tarjetas: 0,
    lesionados: 0
};

// Variables para rastrear goles por equipo
let golesLocal = 0;
let golesVisitante = 0;

function inicializarPartido() {
    commentaryList.innerHTML = '';
    narracionIndex = 0;
    tiempo = 0;
    stats = {goles: 0, faltas: 0, tarjetas: 0, lesionados: 0};
    golesLocal = 0;
    golesVisitante = 0;
    actualizarEstadisticas();
    actualizarMarcador();
    matchTime.textContent = "0'";
    statusIndicator.textContent = "LISTO";
    statusIndicator.className = "status-indicator ready";
    startBtn.disabled = false;
    // pauseBtn.disabled = true; // Eliminado
    // resetBtn.disabled = true; // Eliminado
    
    // Ocultar animación de puntos suspensivos
    document.getElementById('loadingDots').style.display = 'none';
}

function iniciarPartido() {
    if (partidoEnCurso) return;
    partidoEnCurso = true;
    partidoTerminado = false;
    statusIndicator.textContent = "EN JUEGO";
    statusIndicator.className = "status-indicator playing";
    startBtn.disabled = true;
    // pauseBtn.disabled = false; // Eliminado
    // resetBtn.disabled = true; // Eliminado
    
    // Mostrar mensaje de inicio del partido
    const mensajeInicio = document.createElement('div');
    mensajeInicio.className = 'commentary-item';
    mensajeInicio.style.borderLeft = '6px solid #00ffc3';
    mensajeInicio.style.background = '#1a3a2a';
    mensajeInicio.style.color = '#00ffc3';
    mensajeInicio.style.fontWeight = 'bold';
    mensajeInicio.innerHTML =
        `<span class="commentary-minute">0'</span>
<span><strong>¡EL PARTIDO HA COMENZADO!</strong></span>`;
    commentaryList.insertBefore(mensajeInicio, commentaryList.firstChild);
    mensajeInicio.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    
    // Mostrar animación de puntos suspensivos
    document.getElementById('loadingDots').style.display = 'inline-block';
    
    if (!intervalo) {
        intervalo = setInterval(actualizarTiempo, velocidadNarracion);
    }
}

function pausarPartido() {
    if (!partidoEnCurso) return;
    partidoEnCurso = false;
    statusIndicator.textContent = "PAUSADO";
    statusIndicator.className = "status-indicator paused";
    startBtn.disabled = false;
    // pauseBtn.disabled = true; // Eliminado
    // resetBtn.disabled = true; // Eliminado
    clearInterval(intervalo);
    intervalo = null;
    
    // Ocultar animación de puntos suspensivos
    document.getElementById('loadingDots').style.display = 'none';
}

function reiniciarPartido() {
    clearInterval(intervalo);
    intervalo = null;
    partidoEnCurso = false;
    partidoTerminado = false;
    inicializarPartido();
    
    // Ocultar animación de puntos suspensivos
    document.getElementById('loadingDots').style.display = 'none';
}

function actualizarTiempo() {
    if (!partidoEnCurso) return;
    tiempo++;
    matchTime.textContent = `${tiempo}'`;
    // Mostrar todas las narraciones de este minuto
    while (narracionIndex < narraciones.length && narraciones[narracionIndex].minuto === tiempo) {
        mostrarNarracion(narraciones[narracionIndex]);
        narracionIndex++;
    }
    // Solo terminar cuando llegue a los 90 minutos
    if (tiempo >= 90) {
        terminarPartido();
    }
}

function mostrarNarracion(narracion) {
    const nuevaNarracion = document.createElement('div');
    nuevaNarracion.className = 'commentary-item';

    // Lógica de color robusta y explícita para goles
    const tipoEvento = narracion.tipo.toLowerCase();
    const textoNarracion = narracion.texto.toLowerCase();

    if (tipoEvento.includes('gol')) {
        // Verificar si el gol es del equipo del usuario
        if (textoNarracion.includes(equipoUsuario.toLowerCase())) {
            nuevaNarracion.classList.add('gol-favor');
        } else if (textoNarracion.includes(equipoRival.toLowerCase())) {
            nuevaNarracion.classList.add('gol-contra');
        } else {
            // Si no se puede determinar, por defecto gol en contra
            nuevaNarracion.classList.add('gol-contra');
        }
    } else if (tipoEvento.includes('expulsion')) {
        if (textoNarracion.includes(equipoUsuario.toLowerCase())) {
            nuevaNarracion.classList.add('expulsion-propia');
        } else {
            nuevaNarracion.classList.add('expulsion-rival');
        }
    } else if (tipoEvento.includes('amarilla')) {
        nuevaNarracion.classList.add('tarjeta-amarilla');
    } else if (tipoEvento.includes('roja')) {
        nuevaNarracion.classList.add('tarjeta-roja');
    } else if (tipoEvento.includes('lesion')) {
        nuevaNarracion.classList.add('lesion');
    }

    nuevaNarracion.innerHTML = `<span class="commentary-minute">${narracion.minuto}'</span><span>${narracion.texto}</span>`;
    commentaryList.insertBefore(nuevaNarracion, commentaryList.firstChild);
    nuevaNarracion.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    procesarNarracion(narracion.tipo, narracion.texto);
    actualizarEstadisticas();
}

function procesarNarracion(tipo, texto) {
    switch(tipo) {
        case 'GOL': 
            stats.goles++; 
            // Determinar qué equipo marcó basándose en el texto de la narración
            const equipoLocal = document.getElementById('team1Name').textContent;
            const equipoVisitante = document.getElementById('team2Name').textContent;
            
            if (texto.includes(equipoLocal)) {
                golesLocal++;
            } else if (texto.includes(equipoVisitante)) {
                golesVisitante++;
            } else {
                // Si no se puede determinar, alternar
                if (stats.goles % 2 === 1) {
                    golesLocal++;
                } else {
                    golesVisitante++;
                }
            }
            actualizarMarcador();
            break;
        case 'TARJETA_AMARILLA':
        case 'TARJETA_ROJA':
        case 'EXPULSION': stats.tarjetas++; break;
        case 'LESION': stats.lesionados++; break;
        case 'GENERAL': break;
        default: break;
    }
}

function actualizarMarcador() {
    team1Score.textContent = golesLocal;
    team2Score.textContent = golesVisitante;
}

function actualizarEstadisticas() {
    totalGoals.textContent = stats.goles;
    totalFouls.textContent = stats.faltas;
    totalCards.textContent = stats.tarjetas;
    totalInjuries.textContent = stats.lesionados;
}

function terminarPartido(motivoOmitir = false) {
    partidoEnCurso = false;
    partidoTerminado = true;
    clearInterval(intervalo);
    intervalo = null;
    statusIndicator.textContent = "FINALIZADO";
    statusIndicator.className = "status-indicator finished";
    startBtn.disabled = true;
    document.getElementById('loadingDots').style.display = 'none';
    matchTime.textContent = "90'";

    if (!motivoOmitir) {
        const narracionFinal = document.createElement('div');
        narracionFinal.className = 'commentary-item';
        narracionFinal.innerHTML = `<span class="commentary-minute">90'</span><span><strong>¡FINAL DEL PARTIDO!</strong></span>`;
        commentaryList.insertBefore(narracionFinal, commentaryList.firstChild);
        narracionFinal.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // Calcular resultado y goles
    let golesUsuario = 0, golesRival = 0, resultado = '', color = '', monedasGanadas = parseInt(document.getElementById('monedasGanadas') ? document.getElementById('monedasGanadas').value : 0), bonus = 0;
    // --- NUEVO: Extraer goles hechos y recibidos de manera robusta ---
    let golesHechos = [], golesRecibidos = [];
    const nombreLocal = document.getElementById('nombreLocalFinal').value.trim();
    const nombreVisitante = document.getElementById('nombreVisitanteFinal').value.trim();
    const equipoUsuarioNombre = document.getElementById('equipoUsuarioFinal').value.trim().toLowerCase();
    let esLocal = equipoUsuarioNombre === nombreLocal.toLowerCase();
    const miEquipo = esLocal ? nombreLocal : nombreVisitante;
    const rivalEquipo = esLocal ? nombreVisitante : nombreLocal;

    // Recorrer todos los .commentary-item con data-tipo="GOL"
    Array.from(commentaryList.querySelectorAll('.commentary-item')).forEach(item => {
        const tipo = item.getAttribute('data-tipo');
        if (tipo && tipo.toUpperCase() === 'GOL') {
            const minuto = item.getAttribute('data-minuto');
            const texto = item.textContent.trim();
            // Buscar el nombre del jugador (primeras dos palabras después del minuto)
            const match = texto.match(/\d+'\s*([A-Za-záéíóúÁÉÍÓÚñÑ]+\s+[A-Za-záéíóúÁÉÍÓÚñÑ]+)/);
            let nombre = match ? match[1].trim() : '';
            // Determinar si es gol propio o rival
            if (texto.toLowerCase().includes(miEquipo.toLowerCase())) {
                golesHechos.push(`${minuto}' ${nombre}`);
            } else if (texto.toLowerCase().includes(rivalEquipo.toLowerCase())) {
                golesRecibidos.push(`${minuto}' ${nombre}`);
            }
        }
    });

    // Obtener goles reales del backend
    const golesLocal = parseInt(document.getElementById('golesLocalFinal').value);
    const golesVisitante = parseInt(document.getElementById('golesVisitanteFinal').value);
    golesUsuario = esLocal ? golesLocal : golesVisitante;
    golesRival = esLocal ? golesVisitante : golesLocal;

    if (golesUsuario > golesRival) {
        resultado = '¡VICTORIA!';
        color = '#ffd700';
    } else if (golesUsuario === golesRival) {
        resultado = 'EMPATE';
        color = '#b0b0b0';
    } else {
        resultado = 'DERROTA';
        color = '#e74c3c';
    }

    if (!motivoOmitir) {
        monedasGanadas += bonusMonedas;
        bonus = bonusMonedas;
    }

    mostrarPopupFinal(resultado, color, monedasGanadas, bonus, golesHechos, golesRecibidos, motivoOmitir);
}

function mostrarPopupFinal(resultado, color, monedas, bonus, golesHechos, golesRecibidos, omitido) {
    const modal = document.createElement('div');
    modal.className = 'victory-modal';

    // Obtener datos reales del backend SIEMPRE
    const golesLocal = parseInt(document.getElementById('golesLocalFinal').value);
    const golesVisitante = parseInt(document.getElementById('golesVisitanteFinal').value);
    const nombreLocal = document.getElementById('nombreLocalFinal').value;
    const nombreVisitante = document.getElementById('nombreVisitanteFinal').value;
    const equipoUsuarioNombre = document.getElementById('equipoUsuarioFinal').value.trim().toLowerCase();
    let esLocal = equipoUsuarioNombre === nombreLocal.trim().toLowerCase();
    let golesUsuario = esLocal ? golesLocal : golesVisitante;
    let golesRival = esLocal ? golesVisitante : golesLocal;
    let nombreRival = esLocal ? nombreVisitante : nombreLocal;
    let nombreUsuario = esLocal ? nombreLocal : nombreVisitante;

    // Determinar resultado real
    let resultadoTexto = '';
    let colorReal = '';
    if (golesUsuario > golesRival) {
        resultadoTexto = `¡Ganaste ${golesUsuario}-${golesRival} a ${nombreRival}!`;
        colorReal = '#ffd700';
    } else if (golesUsuario < golesRival) {
        resultadoTexto = `Perdiste ${golesUsuario}-${golesRival} contra ${nombreRival}`;
        colorReal = '#e74c3c';
    } else {
        resultadoTexto = `Empataste ${golesUsuario}-${golesRival} con ${nombreRival}`;
        colorReal = '#b0b0b0';
    }

    // Extraer solo los goles: minuto y nombre completo
    function extraerGoleadores(arr) {
        return arr.map(texto => {
            // Buscar minuto y nombre (no narración)
            // Ejemplo de narración: 59' Uriel Gómez presiona fuerte y busca el gol
            const match = texto.match(/(\d+)'\s+([A-Za-záéíóúÁÉÍÓÚñÑ ]+)/);
            if (match) {
                const minuto = match[1];
                let nombre = match[2].trim();
                // Solo el primer nombre y apellido (hasta el primer verbo o palabra no nombre)
                nombre = nombre.split(' ').slice(0,2).join(' ');
                return `<b>${minuto}'</b> ${nombre}`;
            }
            return '';
        }).filter(Boolean).join('<br>');
    }
    let golesHtml = '';
    if (golesHechos.length > 0) {
        golesHtml += `<div style=\"margin-top: 10px; color: #00ffc3; font-weight: bold;\">Tus goles:</div><div style='color:#fff;'>${extraerGoleadores(golesHechos)}</div>`;
    }
    if (golesRecibidos.length > 0) {
        golesHtml += `<div style=\"margin-top: 10px; color: #e74c3c; font-weight: bold;\">Goles rivales:</div><div style='color:#fff;'>${extraerGoleadores(golesRecibidos)}</div>`;
    }
    modal.innerHTML = `
        <div class=\"victory-card\" style=\"border-color: ${colorReal}; background: linear-gradient(135deg, #2d2d2d 0%, ${colorReal}33 100%);\">
            <div class=\"victory-title\" style=\"color: ${colorReal};\">${resultadoTexto}</div>
            <div style=\"margin-top: 20px; font-size: 1.3rem; color: ${colorReal}; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 8px;\">
                <i class='bi bi-coin' style='font-size: 1.5rem;'></i> 
                ${golesUsuario < golesRival ? '<span style=\"color:#e74c3c;\">No ganaste monedas</span>' : `+${monedas} monedas`}
            </div>
            ${bonus > 0 && golesUsuario >= golesRival ? `<div style=\"color:#00ffc3; font-size:1.1rem; margin-top:10px; font-weight:bold;\">+${bonus} bonus por narración completa!</div>` : ''}
            <button id=\"cerrarPopupBtn\" class=\"btn btn-primary\" style=\"margin-top: 30px;\">OK</button>
        </div>
    `;
    document.body.appendChild(modal);
    document.getElementById('cerrarPopupBtn').addEventListener('click', function() {
        modal.remove();
    });
}

// Event listeners
startBtn.addEventListener('click', iniciarPartido);
omiteBtn.addEventListener('click', () => terminarPartido(true));

// Inicializar el partido al cargar la página
inicializarPartido();
</script>